# @unicorn.eth/autoconnect v1.1.2

Drop-in Unicorn wallet integration for React apps with full transaction and signing support.

[![npm version](https://badge.fury.io/js/%40unicorn.eth%2Fautoconnect.svg)](https://www.npmjs.com/package/@unicorn.eth/autoconnect)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## âœ¨ What's New in v1.1.2

- âœ… **Full Transaction Support** - Send ETH, write to contracts, read from contracts
- âœ… **Complete Signing Support** - Sign messages, sign typed data (EIP-712), verify signatures
- âœ… **Universal Hooks** - Works with both Unicorn AND standard wallets
- âœ… **wagmi-like API** - Familiar interface with `async` variants
- âœ… **TypeScript Support** - Full type definitions included

## ğŸ“¦ Installation

```bash
npm install @unicorn.eth/autoconnect
# or
yarn add @unicorn.eth/autoconnect
```

## ğŸš€ Quick Start

### 1. Setup AutoConnect

```tsx
// _app.tsx
import { UnicornAutoConnect } from '@unicorn.eth/autoconnect';

export default function App({ Component, pageProps }) {
  return (
    <WagmiProvider config={config}>
      <QueryClientProvider client={queryClient}>
        <RainbowKitProvider>
          <Component {...pageProps} />
          
          <UnicornAutoConnect
            clientId={process.env.NEXT_PUBLIC_THIRDWEB_CLIENT_ID}
            factoryAddress={process.env.NEXT_PUBLIC_THIRDWEB_FACTORY_ADDRESS}
            defaultChain="base"
            debug={true}
          />
        </RainbowKitProvider>
      </QueryClientProvider>
    </WagmiProvider>
  );
}
```

### 2. Use Universal Hooks

```tsx
import { 
  useUniversalWallet, 
  useUniversalTransaction,
  useUniversalSignMessage 
} from '@unicorn.eth/autoconnect';

function MyComponent() {
  const { address, isConnected, isUnicorn } = useUniversalWallet();
  const { sendTransactionAsync, writeContractAsync } = useUniversalTransaction();
  const { signMessageAsync } = useUniversalSignMessage();

  // Works with BOTH Unicorn and standard wallets! âœ¨
}
```

## ğŸ“š Core Hooks

### `useUniversalWallet()`

Get wallet connection state (works with both wallet types).

```tsx
const wallet = useUniversalWallet();

// Properties
wallet.isConnected   // boolean
wallet.address       // Address | null
wallet.isUnicorn     // boolean (true for Unicorn, false for MetaMask etc.)
wallet.isStandard    // boolean
wallet.connector     // { name: string, id: string }
wallet.chain         // string
wallet.chainId       // number
wallet.disconnect()  // Function to disconnect
```

### `useUniversalTransaction()`

Send transactions and interact with contracts (works with both wallet types).

```tsx
const { 
  sendTransactionAsync,
  writeContractAsync,
  readContractAsync,
  isPending,
  isSuccess,
  error 
} = useUniversalTransaction();

// Send ETH
await sendTransactionAsync({
  to: '0x...',
  value: parseEther('0.001'),
});

// Write to contract
await writeContractAsync({
  address: CONTRACT_ADDRESS,
  abi: ABI,
  functionName: 'mint',
  args: [1],
  value: parseEther('0.01'),
});

// Read from contract
const balance = await readContractAsync({
  address: TOKEN_ADDRESS,
  abi: ERC20_ABI,
  functionName: 'balanceOf',
  args: [userAddress],
});
```

### `useUniversalSignMessage()`

Sign messages and typed data (works with both wallet types).

```tsx
const { 
  signMessageAsync,
  signTypedDataAsync,
  verifyMessage,
  isPending,
  signature 
} = useUniversalSignMessage();

// Sign simple message
const sig = await signMessageAsync({
  message: 'Hello World',
});

// Sign typed data (EIP-712)
const typedSig = await signTypedDataAsync({
  domain: { name: 'MyApp', version: '1', ... },
  types: { Permit: [...] },
  primaryType: 'Permit',
  message: { owner: '0x...', ... },
});

// Verify signature
const isValid = await verifyMessage({
  message: 'Hello World',
  signature: sig,
});
```

## ğŸ¯ Unicorn-Specific Hooks

If you only need Unicorn wallet support (not standard wallets):

### `useUnicornTransaction()`

```tsx
import { useUnicornTransaction } from '@unicorn.eth/autoconnect';

const { sendTransactionAsync, writeContractAsync } = useUnicornTransaction();
```

### `useUnicornSignMessage()`

```tsx
import { useUnicornSignMessage } from '@unicorn.eth/autoconnect';

const { signMessageAsync, signTypedDataAsync } = useUnicornSignMessage();
```

## ğŸ’¡ Common Use Cases

### Send ETH

```tsx
import { useUniversalTransaction } from '@unicorn.eth/autoconnect';
import { parseEther } from 'viem';

function SendETH() {
  const { sendTransactionAsync, isPending } = useUniversalTransaction();

  const handleSend = async () => {
    await sendTransactionAsync({
      to: '0x742d35Cc6634C0532925a3b844Bc454e4438f44e',
      value: parseEther('0.001'),
    });
  };

  return (
    <button onClick={handleSend} disabled={isPending}>
      {isPending ? 'Sending...' : 'Send 0.001 ETH'}
    </button>
  );
}
```

### Mint NFT

```tsx
import { useUniversalTransaction } from '@unicorn.eth/autoconnect';

const NFT_ABI = [
  {
    type: 'function',
    name: 'mint',
    inputs: [{ name: 'quantity', type: 'uint256' }],
    stateMutability: 'payable',
  }
];

function MintNFT() {
  const { writeContractAsync, isPending } = useUniversalTransaction();

  const handleMint = async () => {
    await writeContractAsync({
      address: '0x...',
      abi: NFT_ABI,
      functionName: 'mint',
      args: [1],
      value: parseEther('0.01'),
    });
  };

  return <button onClick={handleMint}>Mint NFT</button>;
}
```

### Transfer ERC-20 Tokens

```tsx
import { useUniversalTransaction } from '@unicorn.eth/autoconnect';

const ERC20_ABI = [
  {
    type: 'function',
    name: 'transfer',
    inputs: [
      { name: 'to', type: 'address' },
      { name: 'amount', type: 'uint256' }
    ],
  }
];

function TransferTokens() {
  const { writeContractAsync } = useUniversalTransaction();

  const handleTransfer = async () => {
    await writeContractAsync({
      address: '0x...', // Token address
      abi: ERC20_ABI,
      functionName: 'transfer',
      args: ['0xRecipient...', parseEther('100')],
    });
  };

  return <button onClick={handleTransfer}>Transfer 100 Tokens</button>;
}
```

### Sign Message

```tsx
import { useUniversalSignMessage } from '@unicorn.eth/autoconnect';

function SignMessage() {
  const { signMessageAsync, isPending } = useUniversalSignMessage();

  const handleSign = async () => {
    const signature = await signMessageAsync({
      message: 'Welcome to my dApp!',
    });
    console.log('Signature:', signature);
  };

  return <button onClick={handleSign}>Sign Message</button>;
}
```

### Check Token Balance

```tsx
import { useUniversalTransaction, useUniversalWallet } from '@unicorn.eth/autoconnect';
import { useEffect, useState } from 'react';

function TokenBalance() {
  const { address } = useUniversalWallet();
  const { readContractAsync } = useUniversalTransaction();
  const [balance, setBalance] = useState('0');

  useEffect(() => {
    if (!address) return;
    
    readContractAsync({
      address: TOKEN_ADDRESS,
      abi: ERC20_ABI,
      functionName: 'balanceOf',
      args: [address],
    }).then(bal => setBalance(bal.toString()));
  }, [address]);

  return <p>Balance: {balance}</p>;
}
```

## ğŸ”§ API Reference

### UnicornAutoConnect Props

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `clientId` | `string` | - | Thirdweb client ID |
| `factoryAddress` | `string` | - | Smart account factory address |
| `defaultChain` | `string` | `'base'` | Default chain ('base', 'polygon', 'ethereum') |
| `timeout` | `number` | `5000` | Connection timeout (ms) |
| `debug` | `boolean` | `false` | Enable debug logging |
| `enableTransactionApproval` | `boolean` | `true` | Show approval dialogs |
| `onConnect` | `(wallet) => void` | - | Callback on connection |
| `onError` | `(error) => void` | - | Callback on error |

### Transaction Hook Return Values

```typescript
{
  // Functions
  sendTransactionAsync: (params) => Promise<any>
  writeContractAsync: (params) => Promise<any>
  readContractAsync: (params) => Promise<any>
  
  // State
  isPending: boolean
  isLoading: boolean
  isSuccess: boolean
  isError: boolean
  error: Error | null
  data: any
  
  // Helpers
  reset: () => void
}
```

### Signing Hook Return Values

```typescript
{
  // Functions
  signMessageAsync: (params) => Promise<Hex>
  signTypedDataAsync: (params) => Promise<Hex>
  verifyMessage: (params) => Promise<boolean>
  
  // State
  isPending: boolean
  isLoading: boolean
  isSuccess: boolean
  isError: boolean
  error: Error | null
  signature: Hex | null
  
  // Helpers
  reset: () => void
}
```

## ğŸŒŸ Features

- âœ… **Zero Config** - Works out of the box with sensible defaults
- âœ… **TypeScript** - Full type safety
- âœ… **Smart Accounts** - Built-in account abstraction support
- âœ… **Gasless Transactions** - Optional gas sponsorship
- âœ… **Multi-Chain** - Base, Polygon, Ethereum, Arbitrum, Optimism
- âœ… **wagmi Compatible** - Works alongside standard wagmi hooks
- âœ… **React 18+** - Supports latest React features
- âœ… **Next.js** - Full SSR/SSG support

## ğŸ”’ Security

- Wallets connect via Thirdweb's secure iframe
- Smart accounts use ERC-4337 standard
- Private keys never leave the secure context
- All transactions require user approval

## ğŸ› Troubleshooting

### "Not in Unicorn environment"

The library only activates when accessed via Unicorn portal with proper URL parameters (`?walletId=inApp&authCookie=...`).

### Transactions failing

1. Check wallet has sufficient balance
2. Verify contract ABI is correct
3. Enable `debug={true}` to see detailed logs
4. Check the contract function is not `view` or `pure`

### State not syncing across components

Make sure you're on v1.1.1+ which includes the global state fix.

## ğŸ“– Examples

See the [examples/](./examples/) directory for complete working examples:

- Basic ETH transfer
- NFT minting
- ERC-20 token operations
- Multi-step transactions
- Signature verification
- Contract interactions

## ğŸ”„ Changelog

### v1.1.2 (2025-10-25)
- âœ… Added `useUniversalTransaction` with full read/write support
- âœ… Added `useUniversalSignMessage` with EIP-712 support
- âœ… Enhanced `useUnicornTransaction` with contract interactions
- âœ… Enhanced `useUnicornSignMessage` with typed data signing
- âœ… Improved TypeScript definitions
- âœ… Added comprehensive examples

### v1.1.1 (2025-10-25)
- ğŸ› Fixed inconsistent wallet state across components
- âœ… Added global state persistence

### v1.1.0 (2025-10-XX)
- âœ… Added pre-built UI components
- âœ… Transaction approval dialogs

## ğŸ“„ License

MIT Â© Unicorn.eth

## ğŸ¤ Contributing

Contributions welcome! Please open an issue or PR.

## ğŸ’¬ Support

- GitHub Issues: [github.com/unicorn-eth/autoconnect/issues](https://github.com/unicorn-eth/autoconnect/issues)
- Discord: [discord.gg/unicorn](https://discord.gg/unicorn)
- Twitter: [@unicorn_eth](https://twitter.com/unicorn_eth)

## ğŸ™ Credits

Built with love by [@cryptowampum](https://twitter.com/cryptowampum) and Claude AI.

Powered by:
- [Thirdweb](https://thirdweb.com) - Wallet infrastructure
- [wagmi](https://wagmi.sh) - React hooks for Ethereum
- [viem](https://viem.sh) - TypeScript Ethereum library